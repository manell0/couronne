{% extends "base.html" %}
{% load static %}


{% block page_header %}
<div class="container header-container">
    <div class="row">
        <div class="col"></div>
    </div>
</div>
{% endblock %} 
 

{% block content %}
<div class="container ">
  <div class="row bg-light">
      <div class="col-md-12 text-center">
        <section>
          <div class="product">
              {% comment %} <img
                  src="https://i.imgur.com/EHyR2nP.png"
                  alt="The cover of Stubborn Attachments"
                  /> {% endcomment %}
              <div class="description">
                  <h3>{{ product.name }}</h3>
                  <h5>${{ product.get_display_price }}</h5>
              </div>
          </div>
          
          
          
      </section>
     </div>
      <div class="col-md-8 text-right">
        <button type="button" id="checkout-button">Donate</button>
      </div><hr />
      <div class="col-md-4 text-right">
        <h3><a class="text-dark text-center" href="{% url 'home:home' %}">&#129044;
          Home</a>
        </h3>
      </div>
  </div>
</div>


<!----------------------------------------------------------------------->
{% csrf_token %}
<script type="text/javascript">
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    // Create an instance of the Stripe object with your publishable API key
    var stripe = Stripe("{{ STRIPE_PUBLIC_KEY }}");
    var checkoutButton = document.getElementById("checkout-button");
    checkoutButton.addEventListener("click", function () {
      fetch("{% url 'create-checkout-session' product.id %}", {
        method: "POST",
        headers: {
            'X-CSRFToken': csrftoken
        }
      })
        .then(function (response) {
          return response.json();
        })
        .then(function (session) {
          return stripe.redirectToCheckout({ sessionId: session.id });
        })
        .then(function (result) {
          // If redirectToCheckout fails due to a browser or network
          // error, you should display the localized error message to your
          // customer using error.message.
          if (result.error) {
            alert(result.error.message);
          }
        })
        .catch(function (error) {
          console.error("Error:", error);
        });
    });
    
    // Disable the button until we have Stripe set up on the page
    document.querySelector("button").disabled = true;
</script>
{% endblock %}
